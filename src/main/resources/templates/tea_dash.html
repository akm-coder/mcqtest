<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Subject Question Management</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        /* Custom styles if needed */
    </style>
</head>

<body class="bg-gray-100">
    <div class="container mx-auto px-4 sm:px-8">
        <div class="py-8">
            <div class="flex flex-row mb-1 sm:mb-0 justify-between w-full">
                <h2 class="text-2xl leading-tight">
                    Exam Subject Question Management
                </h2>
                <div class="text-end">
                    <button id="addQuestionBtn" class="flex-shrink-0 px-4 py-2 text-base font-semibold text-white bg-green-500 rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-green-200">
                        <i class="bi bi-plus-lg"></i> Add Exams
                    </button>
                </div>
            </div>

            <div class="-mx-4 sm:-mx-8 px-4 sm:px-8 py-4 overflow-x-auto">
                <div class="inline-block min-w-full shadow rounded-lg overflow-hidden">
                    <table class="min-w-full leading-normal">
                        <thead>
                            <tr>
                                <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                    Exam Name
                                </th>
                                <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                    Subject
                                </th>
                                
                                <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                    Action
                                </th>

                                <th class="px-5 py-3 border-b-2 border-gray-200 bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                    Exam Paper
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Repeat for each row -->
                            <!--  -->
                            <!-- End of row repeat -->
                        </tbody>
                    </table>
                    <div class="px-5 bg-white py-5 flex flex-col xs:flex-row items-center xs:justify-between">
                        <div class="flex items-center">
                            <button type="button" class="w-full p-4 border text-base rounded-l-xl text-gray-600 bg-white hover:bg-gray-100">
                                <i class="bi bi-chevron-left"></i>
                            </button>
                            <button type="button" class="w-full px-4 py-2 border-t border-b text-base text-indigo-500 bg-white hover:bg-gray-100">
                                1
                            </button>
                            <button type="button" class="w-full p-4 border-t border-b border-r text-base rounded-r-xl text-gray-600 bg-white hover:bg-gray-100">
                                <i class="bi bi-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for adding new question -->
    <div id="addQuestionModal" class="hidden fixed inset-0 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white w-96 p-6 rounded-lg shadow-lg">
                <div class="flex justify-end">
                    <button onclick="hideModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
                <h2 class="text-xl font-semibold mb-4">Add New Question</h2>
                <form id="questionForm">
                    <label for="examName" class="block text-sm font-medium text-gray-600">Exam Name:</label>
                    <input type="text" id="examName" name="examName" class="w-full rounded-lg border-gray-300 mb-4" required>
    
                    <label for="subjectName" class="block text-sm font-medium text-gray-600">Subject Name:</label>
                    <input type="text" id="subjectName" name="subjectName" class="w-full rounded-lg border-gray-300 mb-4" required>
    
                    <button type="button" onclick="addQuestion()" class="w-full px-4 py-2 text-base font-semibold text-white bg-green-500 rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-green-200">
                        Submit
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div id="addQuestionsModal" class="hidden fixed inset-0 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white w-96 p-6 rounded-lg shadow-lg">
                <div class="flex justify-end">
                    <button onclick="hideAddQuestionsModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
                <h2 class="text-xl font-semibold mb-4">Add Number of Questions</h2>
                <form id="addQuestionsForm">
                    <label for="examName" class="block text-sm font-medium text-gray-600">Exam Name:</label>
                    <input type="text" id="examName" name="examName" class="w-full rounded-lg border-gray-300 mb-4" readonly>
    
                    <label for="subjectName" class="block text-sm font-medium text-gray-600">Subject Name:</label>
                    <input type="text" id="subjectName" name="subjectName" class="w-full rounded-lg border-gray-300 mb-4" readonly>
    
                    <label for="numQuestions" class="block text-sm font-medium text-gray-600">Number of Questions:</label>
                    <input type="number" id="numQuestions" name="numQuestions" class="w-full rounded-lg border-gray-300 mb-4" required>
    
                    <button type="button" id="submitQuestionsBtn" class="w-full px-4 py-2 text-base font-semibold text-white bg-green-500 rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-green-200">
                        Submit
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Add this modal after the existing modal -->
    <div id="questionsAddedModal" class="hidden fixed inset-0 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white w-96 p-6 rounded-lg shadow-lg">
                <div class="flex justify-end">
                    <button onclick="hideQuestionsAddedModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
                <h2 class="text-xl font-semibold mb-4">Add Questions</h2>
                <!-- <p><strong>Exam Name:</strong> <span id="examName"></span></p>
                <p><strong>Subject Name:</strong> <span id="subjectName"></span></p> -->
                <div id="questionsContainer"></div>
            </div>
        </div>
    </div>

    <div id="editQuestionsModal" class="hidden fixed inset-0 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white w-96 p-6 rounded-lg shadow-lg">
                <div class="flex justify-end">
                    <button onclick="hideEditModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
                <div id="editQuestionsContainer"></div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Function to show the modal
        function showModal() {
            $('#addQuestionModal').removeClass('hidden');
        }

        // Function to hide the modal
        function hideModal() {
            $('#addQuestionModal').addClass('hidden');
            // Clear input fields after hiding the modal
            $('#examName, #subjectName').val('');
        }

        // Function to add a new question to the table and localStorage
        function addQuestion() {
        const examName = $('#examName').val();
        const subjectName = $('#subjectName').val();

        // Validate input
        if (!examName || !subjectName) {
            alert('Please enter both Exam Name and Subject Name.');
            return;
        }

        // Append a new row to the table
        const newRow = `
            <tr>
                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                    <div class="flex items-center">
                        <div class="ml-3">
                            <p class="text-gray-900 whitespace-no-wrap">${examName}</p>
                        </div>
                    </div>
                </td>
                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                    <p class="text-gray-900 whitespace-no-wrap">${subjectName}</p>
                </td>
                <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                    <a href="#" class="text-blue-600 hover:text-blue-900">Take Action</a>
                </td>
            </tr>
        `;

        // Append the new row to the tbody
        $('tbody').append(newRow);

        // Save the added row data to localStorage
        const existingRows = JSON.parse(localStorage.getItem('addedRows')) || [];
        existingRows.push({ examName, subjectName });
        localStorage.setItem('addedRows', JSON.stringify(existingRows));

        // Hide the modal after adding the question
        hideModal();
    }

        // Function to load added rows from localStorage
        function loadAddedRows() {
            const existingRows = JSON.parse(localStorage.getItem('addedRows')) || [];
            existingRows.forEach(row => {
                const newRow = `
                    <tr>
                        <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                            <div class="flex items-center">
                                <div class="ml-3">
                                    <p class="text-gray-900 whitespace-no-wrap">${row.examName}</p>
                                </div>
                            </div>
                        </td>
                        <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                            <p class="text-gray-900 whitespace-no-wrap">${row.subjectName}</p>
                        </td>
                        <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
                            <a href="#" class="text-blue-600 hover:text-blue-900">Take Action</a>
                        </td>
                    </tr>
                `;
                // Append the loaded row to the tbody
                $('tbody').append(newRow);
            });
        }

        // Event listener for the "Add Question" button
        $('#addQuestionBtn').click(function () {
            showModal();
        });

        // Event listener for the modal close button
        $('#addQuestionModal').click(function (event) {
            if ($(event.target).is('#addQuestionModal')) {
                hideModal();
            }
        });

        // Event listener for the modal close button
        $('#addQuestionModal').on('keydown', function (event) {
            if (event.key === 'Escape') {
                hideModal();
            }
        });

        // Load added rows on page load
        $(document).ready(function () {
            loadAddedRows();
        });
    </script>

<!-- Add this script tag after the existing script tag -->
<script>
    // Function to show the modal for adding questions
function showAddQuestionsModal(examName, subjectName) {
    // Set the examName and subjectName in the modal
    $('#addQuestionsModal #examName').val(examName);
    $('#addQuestionsModal #subjectName').val(subjectName);

    // Show the modal for adding questions
    $('#addQuestionsModal').removeClass('hidden');

    // Dynamically generate input fields for each question
    for (let i = 1; i <= numQuestions; i++) {
        const questionInput = `
            <div class="mb-4">
                <label for="question${i}" class="block text-sm font-medium text-gray-600">Question ${i}:</label>
                <input type="text" id="question${i}" name="question${i}" class="w-full rounded-lg border-gray-300 mb-2" required>

                <label for="options${i}" class="block text-sm font-medium text-gray-600">Options ${i}:</label>
                <input type="text" id="options${i}" name="options${i}" class="w-full rounded-lg border-gray-300 mb-2" required>

                <label for="correctAnswer${i}" class="block text-sm font-medium text-gray-600">Correct Answer ${i}:</label>
                <input type="text" id="correctAnswer${i}" name="correctAnswer${i}" class="w-full rounded-lg border-gray-300 mb-4" required>
            </div>
        `;
        // Append the new input fields to the container in the modal
        $('#addQuestionsModal #questionsContainer').append(questionInput);
    }

    // Add an "Add Questions" button to submit the questions
    const submitButton = `
        <button type="button" onclick="submitAddedQuestions()" class="w-full px-4 py-2 text-base font-semibold text-white bg-blue-500 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-blue-200">
            Add Questions
        </button>
    `;
    $('#addQuestionsModal #questionsContainer').append(submitButton);
}

// Function to submit the added questions
function submitAddedQuestions() {
    // Collect the added questions data
    const addedQuestions = [];
    for (let i = 1; i <= numQuestions; i++) {
        const question = $('#addQuestionsModal #question' + i).val();
        const options = $('#addQuestionsModal #options' + i).val();
        const correctAnswer = $('#addQuestionsModal #correctAnswer' + i).val();

        addedQuestions.push({
            question,
            options,
            correctAnswer
        });
    }

    // Save the questions data to localStorage or perform further actions

    // After submitting, you can hide the modal or perform additional actions
    hideAddQuestionsModal();
}

// Event listener for the "Add Questions" link in each row
$('tbody').on('click', 'a[href="#"]', function () {
    const examName = $(this).closest('tr').find('td:eq(0) p').text();
    const subjectName = $(this).closest('tr').find('td:eq(1) p').text();

    // Store the target row in the modal's data attribute
    $('#addQuestionsModal').data('targetRow', $(this).closest('tr'));

    // Show the addQuestionsModal with the data from the selected row
    showAddQuestionsModal(examName, subjectName);
});

    function hideAllModals() {
            $('#addQuestionModal, #addQuestionsModal, #questionsAddedModal, #editQuestionsModal').addClass('hidden');

            // Clear input fields after hiding the modals
            $('#addQuestionModal #examName, #addQuestionModal #subjectName').val('');
            $('#addQuestionsModal #questionForm input').val('');
            $('#questionsAddedModal #questionsContainer').empty();
            $('#editQuestionsModal #editQuestionsContainer').empty();
        }
    // Function to hide the modal for adding questions
    function hideAddQuestionsModal() {
        // Hide the modal for adding questions
        $('#addQuestionsModal').addClass('hidden');

        // Clear input fields after hiding the modal
        $('#addQuestionsModal #questionForm input').val('');
    }

    // Function to add questions to the table
// Function to add questions to the table
function addQuestionsToTable() {
    const examName = $('#examName').val();
    const subjectName = $('#subjectName').val();
    const numQuestions = $('#numQuestions').val();

    // Validate input
    if (!numQuestions || numQuestions <= 0) {
        alert('Please enter valid values for Number of Questions.');
        return;
    }

    // Find the closest row to the submit button and append a new cell with the "Take Action" link
    const row = $('#addQuestionsModal').data('targetRow');
    const questionsAddedCell = `
        <td class="px-5 py-5 border-b border-gray-200 bg-white text-sm">
            <a href="#" onclick="showQuestionsAddedModal('${examName}', '${subjectName}', ${numQuestions})" class="text-blue-600 hover:text-blue-900">Add Questions</a>
        </td>
    `;

    // Append the new cell to the same row
    $(row).append(questionsAddedCell);

    // Save the added row data to localStorage
    const existingRows = JSON.parse(localStorage.getItem('addedRows')) || [];
    existingRows.push({ examName, subjectName });
    localStorage.setItem('addedRows', JSON.stringify(existingRows));

    // Load Exam Paper data from localStorage
    const examPaperData = JSON.parse(localStorage.getItem('examPaperData')) || {};

    // Add the Exam Paper data for the current row
    examPaperData[examName] = "Add Questions"; // Replace with your dynamic data or logic

    // Save the Exam Paper data to localStorage
    localStorage.setItem('examPaperData', JSON.stringify(examPaperData));

    // Hide the modal after adding questions
    hideAddQuestionsModal();
}



// Event listener for the "Add Questions" link in each row
$('tbody').on('click', 'a[href="#"]', function () {
    const examName = $(this).closest('tr').find('td:eq(0) p').text();
    const subjectName = $(this).closest('tr').find('td:eq(1) p').text();
    
    // Store the target row in the modal's data attribute
    $('#addQuestionsModal').data('targetRow', $(this).closest('tr'));

    showAddQuestionsModal(examName, subjectName);
});



    // Function to show the modal for added questions
    function showQuestionsAddedModal(examName, subjectName, numQuestions) {
        // Set the examName, subjectName, and numQuestions in the modal
        $('#questionsAddedModal #examName').text(examName);
        $('#questionsAddedModal #subjectName').text(subjectName);

        // Show the modal for added questions
        $('#questionsAddedModal').removeClass('hidden');

        // Dynamically generate input fields for each question
        for (let i = 1; i <= numQuestions; i++) {
    // Create a container for the question and options
    const questionContainer = $('<div class="mb-4"></div>');

    // Add the question label and input
    const questionInput = `
        <label for="question${i}" class="block text-sm font-medium text-gray-600">Question ${i}:</label>
        <input type="text" id="question${i}" name="question${i}" class="w-full rounded-lg border-gray-300 mb-2" required>
    `;
    questionContainer.append(questionInput);

    // Add four options for each question
    for (let j = 1; j <= 4; j++) {
        const optionInput = `
            <label for="option${i}_${j}" class="block text-sm font-medium text-gray-600">Option ${j}:</label>
            <input type="text" id="option${i}_${j}" name="option${i}_${j}" class="w-full rounded-lg border-gray-300 mb-2" required>
        `;
        questionContainer.append(optionInput);
    }

    // Add the correct answer input
    const correctAnswerInput = `
        <label for="correctAnswer${i}" class="block text-sm font-medium text-gray-600">Correct Answer ${i}:</label>
        <input type="text" id="correctAnswer${i}" name="correctAnswer${i}" class="w-full rounded-lg border-gray-300 mb-4" required>
    `;
    questionContainer.append(correctAnswerInput);

    // Append the question container to the modal
    $('#questionsAddedModal #questionsContainer').append(questionContainer);
}

        const submitButton = `
            <button type="button" onclick="submitQuestions()" class="w-full px-4 py-2 text-base font-semibold text-white bg-blue-500 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-blue-200">
                Submit Questions
            </button>
        `;
        $('#questionsAddedModal #questionsContainer').append(submitButton);
        $('#questionsAddedModal').removeClass('hidden');

    }

    function submitQuestions() {
        // Check if all input fields are filled
        const allFieldsFilled = Array.from($('#questionsAddedModal input')).every(input => $(input).val().trim() !== '');

        if (!allFieldsFilled) {
            alert('Please fill in all fields before submitting.');
            return;
        }

        // Add your logic here to handle the submission of questions
        // For example, you can retrieve the entered values and perform further actions
        alert('Questions submitted successfully!');

        // Add an "Edit" button to the same row
        const editButton = '<a href="#" class="text-blue-600 hover:text-blue-900" onclick="showEditModal()">Edit</a>';
        const targetRow = $('#addQuestionsModal').data('targetRow');
        $(targetRow).find('td:last').html(editButton);

        // Hide the first modal after adding questions
        hideAllModals();
    }


// Function to show the modal for editing questions
function showEditModal() {
        // Retrieve and display the questions, options, and answers for editing
        const targetRow = $('#addQuestionsModal').data('targetRow');
        const examName = $(targetRow).find('td:eq(0) p').text();
        const subjectName = $(targetRow).find('td:eq(1) p').text();

        // Get the number of questions added for this row
        const numQuestions = parseInt($(targetRow).find('td:last').prev().find('a').text());

        // Create a URL for the editQuestions.html page with query parameters
        const editQuestionsURL = `editQuestions.html?examName=${encodeURIComponent(examName)}&subjectName=${encodeURIComponent(subjectName)}&numQuestions=${numQuestions}`;

        // Open the new page in a new window or tab
        window.open(editQuestionsURL, '_blank');
    }

    // Event listener for the "Edit" button in the dynamically added row
    $('tbody').on('click', 'a.edit-link', function (event) {
        event.preventDefault();
        showEditModal();
    });

    function hideEditModal() {
        // Hide the modal for editing questions
        $('#editQuestionsModal').addClass('hidden');

        // Clear input fields after hiding the modal
        $('#editQuestionsModal #editQuestionsContainer').empty();
    }

    // Event listener for the modal close button
    $('#editQuestionsModal').click(function (event) {
        if ($(event.target).is('#editQuestionsModal')) {
            hideEditModal();
        }
    });

    // Event listener for the modal close button
    $('#editQuestionsModal').on('keydown', function (event) {
        if (event.key === 'Escape') {
            hideEditModal();
        }
    });
    // Function to hide the modal for added questions
    function hideQuestionsAddedModal() {
        // Hide the modal for added questions
        $('#questionsAddedModal').addClass('hidden');

        // Clear input fields after hiding the modal
        $('#questionsAddedModal #questionsContainer').empty();
        hideAllModals();
    }

    // Event listener for the "Add Questions" link in each row
    $('tbody').on('click', 'a[href="#"]', function () {
        const examName = $(this).closest('tr').find('td:eq(0) p').text();
        const subjectName = $(this).closest('tr').find('td:eq(1) p').text();
        showAddQuestionsModal(examName, subjectName);

    });

    // Event listener for the modal close button
    $('#addQuestionsModal').click(function (event) {
        if ($(event.target).is('#addQuestionsModal')) {
            hideAddQuestionsModal();
        }
    });

    // Event listener for the modal close button
    $('#addQuestionsModal').on('keydown', function (event) {
        if (event.key === 'Escape') {
            hideAddQuestionsModal();
        }
    });

    // Event listener for the "Submit" button in the modal for adding questions
    $('#addQuestionsModal #submitQuestionsBtn').click(function () {
        addQuestionsToTable();
    });

    // Event listener for the modal close button
    $('#questionsAddedModal').click(function (event) {
        if ($(event.target).is('#questionsAddedModal')) {
            hideQuestionsAddedModal();
        }
    });

    // Event listener for the modal close button
    $('#questionsAddedModal').on('keydown', function (event) {
        if (event.key === 'Escape') {
            hideQuestionsAddedModal();
        }
    });
</script>

</body>

</html>
